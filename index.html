<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            TORO Chat with OTR Encryption
        </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
        <meta content="en-us" http-equiv="Content-Language"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <link href="f.css" rel="stylesheet" type="text/css"/>
        <link href="filedrop.css" rel="stylesheet" type="text/css"/>
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"/>
        <link href="/css/rrssb.css" rel="stylesheet"/>
        <link href="ico.ico" rel="icon" type="image/png"/>
    </head>
    <body style="background: #272822;">
        <div class="tabl">
            <div class="Row">
                <div class="ri">
                        <a href="">
                            <img src="icone.png" style="width: 8%;">
                        </a>
                        <h1 style="font-size: 3em;">
                            <a href="" style="text-decoration: none;">TORO</a>
                            <a href="https://github.com/Sanix-Darker" target="_blank">
                                <small style="font-size: 12px;">
                                    by S@n1x D4rk3r
                                </small>
                            </a>
                        </h1>

<style type="text/css">
    #remotes .videoContainer video{height: 250px; width: 300px; } 
</style>

                            <table style="width:100%;">
                                <tr>
                                    <td style="width: 5%;"></td>
                                    <td style="width: 20%;">
                                        <button id="screenShareButton" style="display: none;"></button>
                                        <p id="subTitle" style="display: none;"></p>
                                        <form id="createRoom" style="display: none;position: absolute;">
                                            <input id="sessionInput" value="" />
                                            <button type="submit">Create it!</button>
                                        </form>
                                        <div class="videoContainer">
                                            <video id="localVideo" style="height: 250px; width: 300px;" oncontextmenu="return false;"></video>
                                            <div id="localVolume" class="volume_bar"></div>
                                        </div>
                                        <div id="remotes" style="margin-top: 5px;"></div>
                                    </td>
                                    <td >

                                                <div class="tp" id="actions">
                                                    <span id="urlid">
                                                        To start a secure chat, send this url to your peer:<br>
                                                        <span id="purl">
                                                            Your link is loading, please wait a few second....
                                                        </span><br>
                                                        <center>
                                                            <input type="button" value="Copy link" onclick="copyToClipboard('#purl')" style="background: black;color: white;padding: 10px;cursor: pointer;" id="copylinked">
                                                            <input type="button" value="Change it" style="background: red;color: white;padding: 10px;cursor: pointer;" onclick="location.reload()">
                                                        </center>
                                                    </span>
                                                    <div style="display: none;">
                                                        <span id="idid">
                                                            or send your id:
                                                            <span id="pid">
                                                            </span>
                                                        </span>
                                                        <br>
                                                        <span id="connid">
                                                            or enter someone else's id:
                                                            <input id="rid" placeholder="someone" size="7" type="text">
                                                                <input class="button" id="connect" type="button" value="Connect">
                                                                </input>
                                                            </input>
                                                        </span>
                                                    </div>

                                                </div>

                                                <div id="connections">
                                                    <span class="filler">
                                                        <div class="about"> <h1> Welcome to TORO, an anonymous, secure and p2p encrypted chat. </h1> <hr> <p> I believe that everyone has the right to communicate privately. If you agree, share with others: </p>
                                                            <center>

                        <ul class="rrssb-buttons clearfix"> <li class="rrssb-facebook"> <a href="#" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;" target="_blank"> <span class="rrssb-icon"> <svg enable-background="new 0 0 28 28" height="28px" id="Layer_1" version="1.1" viewbox="0 0 28 28" width="28px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"> </path> </svg> </span> <span class="rrssb-text"> facebook </span> </a> </li> <li class="rrssb-twitter"> <a href="#" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;" target="_blank" title="Tweet"> <span class="rrssb-icon"> <svg enable-background="new 0 0 28 28" height="28px" id="Layer_1" version="1.1" viewbox="0 0 28 28" width="28px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"> </path> </svg> </span> <span class="rrssb-text"> twitter </span> </a> </li> <li class="rrssb-googleplus"> <!-- Replace href with your meta and URL information.  --> <a href="#" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;" target="_blank" title="Share on Google+"> <span class="rrssb-icon"> <svg enable-background="new 0 0 28 28" height="28px" id="Layer_1" version="1.1" viewbox="0 0 28 28" width="28px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"> <g> <g> <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"> </path> <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "> </polygon> </g> </g> </svg> </span> <span class="rrssb-text"> google+ </span> </a> </li> </ul>
                        </center>                                    
                     </div> <br/>
                </span>
                <div id="logg">
                </div>
            </div>
                        <form id="send" style="display:none;">
                            <div id="tarea">
                                <textarea class="chat" id="text" placeholder="Type your message here. Enter - send message. Ctrl+enter - new line">
                                </textarea>
                            </div>
                            <br>
                                <table class="swTab">
                                    <tr>
                                        <td>
                                            Sound
                                            <br>
                                                <div class="onoffswitch" id="ae">
                                                    <input checked="" class="onoffswitch-checkbox" id="sound" name="onoffswitch" type="checkbox">
                                                        <label class="onoffswitch-label" for="sound">
                                                            <span class="onoffswitch-inner">
                                                            </span>
                                                            <span class="onoffswitch-switch">
                                                            </span>
                                                        </label>
                                                    </input>
                                                </div>

                                        </td>
                                        <td>
                                            Encryption
                                            <br>
                                                <div class="onoffswitch" id="ae1">
                                                    <input class="onoffswitch-checkbox" id="otron" name="onoffswitch" type="checkbox">
                                                        <label class="onoffswitch-label" for="otron">
                                                            <span class="onoffswitch-inner">
                                                            </span>
                                                            <span class="onoffswitch-switch">
                                                            </span>
                                                        </label>
                                                    </input>
                                                </div>

                                        </td>
                                        <td>
                                            <input onclick="window.open('https://sanix-darker.github.io/TORO/');" type="submit" value="open new chat">
                                            </input>
                                        </td>
                                        <td>
                                            <a class="linktip" href="#" title="Send encrypted file">
                                                <i class="fa fa-paperclip fa-2x" id="paperclip">
                                                </i>
                                            </a>
                                        </td>
                                        <td>
                                            <input class="button" id="bsend" type="submit" value="Send"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                        </td>
                                        <td>
                                            <img id="waitotr" src="486.gif" style="display:none;"/>
                                        </td>
                                        <td>
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                </table>

                        </form>
                    </td>
                </tr>
            </table>

                        <br>

                </div>
                <audio id="chatAudio">
                    <source src="waterdrop.mp3" type="audio/mpeg">
                    </source>
                </audio>
            </div>
        </div>

        <script type="text/javascript">
            
            if(window.location.href.indexOf("?") > -1) {

            }else{
                var THEROOM = window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
                document.location = document.URL+'?'+THEROOM+'/';
            }

        </script>

        <script src="js/vendor/jquery.1.10.2.min.js" type="text/javascript"></script>
        <script src="peer.js" type="text/javascript"></script>
        <script src="build/dep/bigint.js"></script>
        <script src="build/dep/crypto.js"></script>
        <script src="build/dep/eventemitter.js"></script>
        <script src="build/otr.js"></script>
        <script src="js/rrssb.min.js"></script>
        <script src="filedrop-min.js"></script>
        <script src="hoverIntent.min.js"></script>
        <script src="/rollups/aes.js" type="text/javascript"></script>
        <script src="/components/enc-base64-min.js" type="text/javascript"></script>
        <script src="/rollups/sha256.js" type="text/javascript"></script>
        <script src="js/js.js" type="text/javascript"></script>

        <script type="text/javascript">
            

            function copyToClipboard(element) {
              var $temp = $("<input>");
              $("body").append($temp);
              $temp.val($(element).text()).select();
              document.execCommand("copy");
              $temp.remove();
              alert("Link copied!");
            }
 
        </script>

        <script src="js/simplewebrtc.js"></script>
        <script>

            setInterval(function(){
                $('#sessionInput').val($('#purl').html());
            }, 1750);

            // grab the room from the URL
            var room = (document.URL.split('?')[1]).split('/#')[0];

            // create our webrtc connection
            var webrtc = new SimpleWebRTC({
                // the id/element dom element that will hold "our" video
                localVideoEl: 'localVideo',
                // the id/element dom element that will hold remote videos
                remoteVideosEl: '',
                // immediately ask for camera access
                autoRequestMedia: true,
                debug: false,
                detectSpeakingEvents: true
            });

            // when it's ready, join if we got a room from the URL
            webrtc.on('readyToCall', function () {
                // you can name it anything
                if (room) webrtc.joinRoom(room);
            });

            function showVolume(el, volume) {
                if (!el) return;
                if (volume < -45) { // vary between -45 and -20
                    el.style.height = '0px';
                } else if (volume > -20) {
                    el.style.height = '100%';
                } else {
                    el.style.height = '' + Math.floor((volume + 100) * 100 / 25 - 220) + '%';
                }
            }
            webrtc.on('channelMessage', function (peer, label, data) {
                if (data.type == 'volume') {
                    showVolume(document.getElementById('volume_' + peer.id), data.volume);
                }
            });
            webrtc.on('videoAdded', function (video, peer) {
                console.log('video added', peer);
                var remotes = document.getElementById('remotes');
                if (remotes) {
                    var d = document.createElement('div');
                    d.className = 'videoContainer';
                    d.id = 'container_' + webrtc.getDomId(peer);
                    d.appendChild(video);
                    var vol = document.createElement('div');
                    vol.id = 'volume_' + peer.id;
                    vol.className = 'volume_bar';
                    video.onclick = function () {
                        video.style.width = video.videoWidth + 'px';
                        video.style.height = video.videoHeight + 'px';
                    };
                    d.appendChild(vol);
                    remotes.appendChild(d);
                }
            });
            webrtc.on('videoRemoved', function (video, peer) {
                console.log('video removed ', peer);
                var remotes = document.getElementById('remotes');
                var el = document.getElementById('container_' + webrtc.getDomId(peer));
                if (remotes && el) {
                    remotes.removeChild(el);
                }
            });
            webrtc.on('volumeChange', function (volume, treshold) {
                //console.log('own volume', volume);
                showVolume(document.getElementById('localVolume'), volume);
            });

            // Since we use this twice we put it here
            function setRoom(name) {
                //$('form').remove();
                //$('h1').text(name);
                $('#subTitle').text('Link to join: ' + location.href);
                $('body').addClass('active');
            }

            if (room) {
                setRoom(room);
            } else {
                $('#createRoom').submit(function () {
                    var val = $('#sessionInput').val().toLowerCase().replace(/\s/g, '-').replace(/[^A-Za-z0-9_\-]/g, '');
                    webrtc.createRoom(val, function (err, name) {
                        console.log(' create room cb', arguments);

                        var newUrl = location.pathname + '?' + name;
                        if (!err) {
                            history.replaceState({foo: 'bar'}, null, newUrl);
                            setRoom(name);
                        } else {
                            console.log(err);
                        }
                    });
                    return false;
                });
            }

            var button = $('#screenShareButton'),
                setButton = function (bool) {
                    button.text(bool ? 'share screen' : 'stop sharing');
                };
            webrtc.on('localScreenStopped', function () {
                setButton(true);
            });

            setButton(true);

            button.click(function () {
                if (webrtc.getLocalScreen()) {
                    webrtc.stopScreenShare();
                    setButton(true);
                } else {
                    webrtc.shareScreen(function (err) {
                        if (err) {
                            setButton(true);
                        } else {
                            setButton(false);
                        }
                    });

                }
            });
        </script>
    </body>
</html>
<style type="text/css">
    .messages{
        max-height: 23em!important;
    }
</style>


