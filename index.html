<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            TORO Chat with OTR Encryption
        </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
        <meta content="en-us" http-equiv="Content-Language"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <link href="f.css" rel="stylesheet" type="text/css"/>
        <link href="filedrop.css" rel="stylesheet" type="text/css"/>
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"/>
        <link href="/css/rrssb.css" rel="stylesheet"/>
        <link href="ico.ico" rel="icon" type="image/png"/>
    </head>
    <body style="background: #272822;">
        <div class="tabl">
            <div class="Row">
                <div class="ri">
                        <a href="">
                            <img src="icone.png" style="width: 8%;">
                        </a>
                        <h1 style="font-size: 3em;">
                            <a href="" style="text-decoration: none;">TORO</a>
                            <a href="https://github.com/Sanix-Darker" target="_blank">
                                <small style="font-size: 12px;">
                                    by S@n1x D4rk3r
                                </small>
                            </a>
                        </h1>

<style type="text/css">
    #remotes .videoContainer video{height: 250px; width: 300px; } 
</style>

                            <table style="width:100%;">
                                <tr>
                                    <td style="width: 5%;"></td>
                                    <td style="width: 20%;">
                                        <button id="screenShareButton" style="display: none;"></button>
                                        <p id="subTitle" style="display: none;"></p>
                                        <form id="createRoom" style="display: none;position: absolute;">
                                            <input id="sessionInput" value="" />
                                            <button type="submit">Create it!</button>
                                        </form>
                                        <div class="videoContainer">
                                            <video id="localVideo" style="height: 250px; width: 300px;" oncontextmenu="return false;"></video>
                                            <div id="localVolume" class="volume_bar"></div>
                                        </div>
                                        <div id="remotes" style="margin-top: 5px;"></div>
                                    </td>
                                    <td >

                                                <div class="tp" id="actions">
                                                    <span id="urlid">
                                                        To start a secure chat, send this url to your peer:<br>
                                                        <span id="purl">
                                                            Your link is loading, please wait a few second....
                                                        </span><br>
                                                        <center>
                                                            <input type="button" value="Copy link" onclick="copyToClipboard('#purl')" style="background: black;color: white;padding: 10px;cursor: pointer;" id="copylinked">
                                                            <input type="button" value="Change it" style="background: red;color: white;padding: 10px;cursor: pointer;" onclick="document.location=window.location.protocol+'//'+window.location.host">
                                                        </center>
                                                    </span>
                                                    <div style="display: none;">
                                                        <span id="idid">
                                                            or send your id:
                                                            <span id="pid">
                                                            </span>
                                                        </span>
                                                        <br>
                                                        <span id="connid">
                                                            or enter someone else's id:
                                                            <input id="rid" placeholder="someone" size="7" type="text">
                                                                <input class="button" id="connect" type="button" value="Connect">
                                                                </input>
                                                            </input>
                                                        </span>
                                                    </div>

                                                </div>

                                                <div id="connections">
                                                    <span class="filler">
                                                        <div class="about"> <h1> Welcome to TORO, an anonymous, secure and p2p encrypted chat. </h1> <hr> <p> I believe that everyone has the right to communicate privately. If you agree, share with others: </p>
                                                            <center>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 27%;">
                                        <a href="#" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;" target="_blank"><img src="social/facebook.PNG"></a>
                                    </td>
                                    <td style="width: 1%;"></td>
                                    <td style="width: 27%;">
                                        <a href="#" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;" target="_blank" title="Tweet"><img src="social/twitter.PNG"></a>
                                    </td>
                                    <td style="width: 1%;"></td>
                                    <td style="width: 27%;">
                                        <a href="#" onclick="window.open('https://plus.google.com/share?url=' + encodeURIComponent(document.URL)); return false;" target="_blank" title="Share on Google+"><img src="social/googleplus.PNG"></a>
                                    </td>
                                </tr>
                            </table>

                        </center>                                    
                     </div> <br/>
                </span>
                <div id="logg">
                </div>
            </div>
                        <form id="send" style="display:none;">
                            <div id="tarea">
                                <textarea class="chat" id="text" placeholder="Type your message here. Enter - send message. Ctrl+enter - new line">
                                </textarea>
                            </div>
                            <br>
                                <table class="swTab">
                                    <tr>
                                        <td>
                                            Sound
                                            <br>
                                                <div class="onoffswitch" id="ae">
                                                    <input checked="" class="onoffswitch-checkbox" id="sound" name="onoffswitch" type="checkbox">
                                                        <label class="onoffswitch-label" for="sound">
                                                            <span class="onoffswitch-inner">
                                                            </span>
                                                            <span class="onoffswitch-switch">
                                                            </span>
                                                        </label>
                                                    </input>
                                                </div>

                                        </td>
                                        <td>
                                            Encryption
                                            <br>
                                                <div class="onoffswitch" id="ae1">
                                                    <input class="onoffswitch-checkbox" id="otron" name="onoffswitch" type="checkbox">
                                                        <label class="onoffswitch-label" for="otron">
                                                            <span class="onoffswitch-inner">
                                                            </span>
                                                            <span class="onoffswitch-switch">
                                                            </span>
                                                        </label>
                                                    </input>
                                                </div>

                                        </td>
                                        <td>
                                            <input onclick="window.open('https://sanix-darker.github.io/TORO/');" type="submit" value="open new chat">
                                            </input>
                                        </td>
                                        <td>
                                            <a class="linktip" href="#" title="Send encrypted file">
                                                <i class="fa fa-paperclip fa-2x" id="paperclip">
                                                </i>
                                            </a>
                                        </td>
                                        <td>
                                            <input class="button" id="bsend" type="submit" value="Send"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                        </td>
                                        <td>
                                            <img id="waitotr" src="486.gif" style="display:none;"/>
                                        </td>
                                        <td>
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                </table>

                        </form>
                    </td>
                </tr>
            </table>

                        <br>

                </div>
                <audio id="chatAudio">
                    <source src="waterdrop.mp3" type="audio/mpeg">
                    </source>
                </audio>
            </div>
        </div>

        <script type="text/javascript">
            
            if(window.location.href.indexOf("?") > -1) {

            }else{
                var THEROOM = window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
                document.location = document.URL+'?'+THEROOM+'/';
            }

        </script>

        <script src="js/vendor/jquery.1.10.2.min.js" type="text/javascript"></script>
        <script src="peer.js" type="text/javascript"></script>
        <script src="build/dep/bigint.js"></script>
        <script src="build/dep/crypto.js"></script>
        <script src="build/dep/eventemitter.js"></script>
        <script src="build/otr.js"></script>
        <script src="js/rrssb.min.js"></script>
        <script src="filedrop-min.js"></script>
        <script src="hoverIntent.min.js"></script>
        <script src="/rollups/aes.js" type="text/javascript"></script>
        <script src="/components/enc-base64-min.js" type="text/javascript"></script>
        <script src="/rollups/sha256.js" type="text/javascript"></script>
        <script src="js/js.js" type="text/javascript"></script>

        <script type="text/javascript">
            

            function copyToClipboard(element) {
              var $temp = $("<input>");
              $("body").append($temp);
              $temp.val($(element).text()).select();
              document.execCommand("copy");
              $temp.remove();
              alert("Link copied!");
            }
 
        </script>

        <script src="js/simplewebrtc.js"></script>
        <script>

            setInterval(function(){
                $('#sessionInput').val($('#purl').html());
            }, 1750);

            // grab the room from the URL
            var room = (document.URL.split('?')[1]).split('/#')[0];

            // create our webrtc connection
            var webrtc = new SimpleWebRTC({
                // the id/element dom element that will hold "our" video
                localVideoEl: 'localVideo',
                // the id/element dom element that will hold remote videos
                remoteVideosEl: '',
                // immediately ask for camera access
                autoRequestMedia: true,
                debug: false,
                detectSpeakingEvents: true
            });

            // when it's ready, join if we got a room from the URL
            webrtc.on('readyToCall', function () {
                // you can name it anything
                if (room) webrtc.joinRoom(room);
            });

            function showVolume(el, volume) {
                if (!el) return;
                if (volume < -45) { // vary between -45 and -20
                    el.style.height = '0px';
                } else if (volume > -20) {
                    el.style.height = '100%';
                } else {
                    el.style.height = '' + Math.floor((volume + 100) * 100 / 25 - 220) + '%';
                }
            }
            webrtc.on('channelMessage', function (peer, label, data) {
                if (data.type == 'volume') {
                    showVolume(document.getElementById('volume_' + peer.id), data.volume);
                }
            });
            webrtc.on('videoAdded', function (video, peer) {
                console.log('video added', peer);
                var remotes = document.getElementById('remotes');
                if (remotes) {
                    var d = document.createElement('div');
                    d.className = 'videoContainer';
                    d.id = 'container_' + webrtc.getDomId(peer);
                    d.appendChild(video);
                    var vol = document.createElement('div');
                    vol.id = 'volume_' + peer.id;
                    vol.className = 'volume_bar';
                    video.onclick = function () {
                        video.style.width = video.videoWidth + 'px';
                        video.style.height = video.videoHeight + 'px';
                    };
                    d.appendChild(vol);
                    remotes.appendChild(d);
                }
            });
            webrtc.on('videoRemoved', function (video, peer) {
                console.log('video removed ', peer);
                var remotes = document.getElementById('remotes');
                var el = document.getElementById('container_' + webrtc.getDomId(peer));
                if (remotes && el) {
                    remotes.removeChild(el);
                }
            });
            webrtc.on('volumeChange', function (volume, treshold) {
                //console.log('own volume', volume);
                showVolume(document.getElementById('localVolume'), volume);
            });

            // Since we use this twice we put it here
            function setRoom(name) {
                //$('form').remove();
                //$('h1').text(name);
                $('#subTitle').text('Link to join: ' + location.href);
                $('body').addClass('active');
            }

            if (room) {
                setRoom(room);
            } else {
                $('#createRoom').submit(function () {
                    var val = $('#sessionInput').val().toLowerCase().replace(/\s/g, '-').replace(/[^A-Za-z0-9_\-]/g, '');
                    webrtc.createRoom(val, function (err, name) {
                        console.log(' create room cb', arguments);

                        var newUrl = location.pathname + '?' + name;
                        if (!err) {
                            history.replaceState({foo: 'bar'}, null, newUrl);
                            setRoom(name);
                        } else {
                            console.log(err);
                        }
                    });
                    return false;
                });
            }

            var button = $('#screenShareButton'),
                setButton = function (bool) {
                    button.text(bool ? 'share screen' : 'stop sharing');
                };
            webrtc.on('localScreenStopped', function () {
                setButton(true);
            });

            setButton(true);

            button.click(function () {
                if (webrtc.getLocalScreen()) {
                    webrtc.stopScreenShare();
                    setButton(true);
                } else {
                    webrtc.shareScreen(function (err) {
                        if (err) {
                            setButton(true);
                        } else {
                            setButton(false);
                        }
                    });

                }
            });
        </script>
    </body>
</html>
<style type="text/css">
    .messages{
        max-height: 23em!important;
    }
</style>


